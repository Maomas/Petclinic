/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */


buildscript {
  repositories {
    maven {
      url "https://plugins.gradle.org/m2/"
    }
  }
  /*
  Déclaration des dépendances
  Une dépendance est un élément utile et externe au projet, permettant sa construction
  Exemple : Un fichier JAR provenant d'un autre projet
  */
  dependencies {
    //Ajout de la dépendance 'liquibase' au classpath
    classpath "gradle.plugin.org.liquibase:liquibase-gradle-plugin:2.0.1"
  }
}

/*
Ajout des plugins
Un plugin est un ensemble de tâches, comme des tâches de compilation, de mise en place des fichiers source, etc.
*/
apply plugin: 'java'
apply plugin: 'org.liquibase.gradle'

repositories {
	mavenCentral()
}

dependencies {

    compile("org.springframework.boot:spring-boot-starter:2.0.6.RELEASE")
    // Use MySQL Connector-J
    runtime 'mysql:mysql-connector-java:8.0.12'

    compile("org.springframework:spring-jdbc:3.2.4.RELEASE")

	testCompile('org.junit.jupiter:junit-jupiter-api:5.3.1')
	testRuntime('org.junit.jupiter:junit-jupiter-engine:5.3.1')
  
    compile ('commons-dbcp:commons-dbcp:1.4')

    liquibaseRuntime 'org.liquibase:liquibase-core:3.6.1'
    liquibaseRuntime 'org.liquibase:liquibase-groovy-dsl:2.0.1'
    liquibaseRuntime 'mysql:mysql-connector-java:8.0.12'
}

task copyConfigXML(type: Copy) {
    from ("src/be/heh/petclinic"){
    include '**/*.xml'}

    into ("build/classes/java/main/be/heh/petclinic")
}

build.finalizedBy(copyConfigXML)

/*

*/
sourceSets {
  main{
      java {
          srcDirs = ['src']
      }
      resources {
            srcDirs = ['src/resources']
        }
  }  

   test{
      java {
          srcDirs = ['test/unit']
      }
  }  
}

test {
    useJUnitPlatform()
}

def changeLog = "$projectDir/src/resources/db-migration/master.xml"

/*
Une tâche (task) est une suite d'instructions que Gradle effectue
Cette tâche est nommée 'dev'
Commande pour exécuter la tâche : gradle -q dev
*/
task('dev'){
    //Les instructions se trouvent dans la déclaration 'doLast'
    doLast {
    //Alerte l'utilisateur que la tâche s'effectue
    println "=== Executing dev ==="
    liquibase {
        activities {
         main {
                changeLogFile changeLog
                url 'jdbc:mysql://127.0.0.1:3306/petclinic'
                username 'root'
                password 'Test123*'
                driver 'com.mysql.cj.jdbc.Driver'
            }
        }
    }    
    }  
} 


